---
title: "Assignment_6_JH_GE"
author: "Jon Hart & Garrett Eyer"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE )
```
### **Introduction**

![](salamander_pic.PNG){width=400px}  
**Figure 1.** *Pacific Giant Salamander (Credit: [Sierra Nystrom](http://natural-history-journal.blogspot.com/2017/06/pacific-giant-salamander-at-prairie.html))*

![](map1.PNG){width=400px}  
**Figure 2.** *The Mack Creek study site is located in the HJ Andrews Experimental Forest, Oregon. (Credit: [Dana Warren](https://www.researchgate.net/figure/Map-of-study-sites-and-the-HJ-Andrews-Experimental-forest-HJA-Each-dot-represents-a_fig1_314206020))*

![](mack_creek.PNG){width=450px}  
**Figure 3.** *Mack Creek, HJ Andrews Experimental Forest, OR (Credit: [Oregon State University](https://www.flickr.com/photos/oregonstateuniversity/7468126552/))*

```{r}
library(tidyverse)
library(janitor)
library(here)
library(ggridges)
library(ggbeeswarm)
library(car)
library(kableExtra)
library(effsize)
library(directlabels)
```
### **Data and Methods**

### **Results**

```{r}

# A. Visually compare annual salamander counts in old growth (OG) and clear cut (CC) sections of Mack Creek

salamander_data <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE") %>% 
  mutate(riv_section = case_when(
         section == "OG" ~ "Old Growth",
         section == "CC" ~ "Clear Cut")) %>% 
  mutate(channel_class = (case_when(
            unittype == "C" ~ "Cascade", 
            unittype == "SC" ~ "Side Channel",
            unittype == "P" ~ "Pool"))) 
  

sal_counts <- salamander_data %>% 
  group_by(year, riv_section) %>% 
  summarize(total_count = n()) 
   

ggplot(data = sal_counts, aes(x = year, y = total_count)) +
  geom_line(aes(color = riv_section),
            size = 1) +
  geom_point(size = 1) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(1992.5, 2017.5),
                     breaks = seq(1993, 2017, by = 2)) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0, 500),
                     breaks = seq(0, 500, by = 100)) +
  theme_minimal() +
  labs(title = "Pacific Giant Salamander Counts",
       subtitle = "Mack Creek, OR (1993-2017)",
       x = "Year",
       y = "Salamander Count") +
  theme(axis.text.x = element_text(angle= 90, 
                                   hjust = 1),
        legend.title = element_blank(),
        legend.position = "bottom") 

            
```




```{r}
# B. Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.  

sal_count_2017 <- salamander_data %>% 
  filter(year == "2017") %>% 
  filter(unittype %in% c("P", "C", "SC")) %>% 
  count(riv_section, channel_class)

# Put it into wide format (contingency table):
sal_count_table <- sal_count_2017 %>% 
  pivot_wider(names_from = riv_section, values_from = n)

# Make table with proportions
sal_count_props <- sal_count_table %>% 
  janitor::adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front") %>% 
  rename("Channel Class" = channel_class) 

# Put in nice formatted table
kable(sal_count_props) %>% 
  kable_styling()


```


```{r}
# C.Using the 2017 counts found in Results B above, answer: is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)?

chi_sal_counts <- sal_count_table %>% 
  select(-channel_class)

sal_counts_chi <- chisq.test(chi_sal_counts)

sal_counts_chi

```

There is not a significant association between forest condition (old growth/clear cut) on where in the channel salamanders are found (pool/side-channel/cascade) for salamanders sampled in 2017. ($\chi$^2^(`r sal_counts_chi$parameter`) = `r round(sal_counts_chi$statistic,2)`, *p* = `r round(sal_counts_chi$p.value, 3)`).

```{r}
# D. Compare weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017.

sal_weights_cc <- salamander_data %>% 
  filter(year == "2017", section == "CC") 

sal_weights_og <- salamander_data %>%   
  filter(year == "2017", section == "OG") 

# mean weights
mean_weights_cc <- mean(sal_weights_cc$weight, na.rm = TRUE)
mean_weights_og <- mean(sal_weights_og$weight, na.rm = TRUE)

# weights standard deviation
sd_weights_cc <- sd(sal_weights_cc$weight, na.rm = TRUE)
sd_weights_og <- sd(sal_weights_og$weight, na.rm = TRUE)

# sample size
n_2017_cc <- sum(!is.na(sal_weights_cc$weight))
n_2017_og <- sum(!is.na(sal_weights_og$weight))

# t-test
weight_ttest_og <- sal_weights_og %>% 
  pull(weight)

weight_ttest_cc <- sal_weights_cc %>% 
  pull(weight)

sal_weight_ttest <- t.test(weight_ttest_og, weight_ttest_cc)
sal_weight_ttest 

# Cohen's d, creek section

sal_weight_d <- cohen.d(weight_ttest_cc, weight_ttest_og, na.rm = TRUE)
sal_weight_d
```

There is not enough evidence to conclude that mean Pacific Giant Salamander size in the clear cut section of Mack Creek in 2017 (`r round(mean_weights_cc, 2)` $\pm$ `r round(sd_weights_cc, 2)`, n = `r n_2017_cc`) differed significantly from mean Pacific Giant Salamander size in the old growth section of Mack Creek in 2017 (`r round(mean_weights_og, 2)` $\pm$ `r round(sd_weights_og, 2)`, n = `r n_2017_og`) by a two-sided, two sample t-test (t(`r round(sal_weight_ttest$parameter, 2)`) = `r round(sal_weight_ttest$statistic, 2)`, *p* = `r round(sal_weight_ttest$p.value, 3)`). In addition, the effect size between mean sizes is negligible (Cohen's *d* = `r round(sal_weight_d$estimate, 2)`). 


```{r}
# E. Visually compare Pacific giant salamander weights between the three channel classifications. You can choose how to best visualize the weights between the three groups

sal_weights_class <- salamander_data %>% 
  filter(year == "2017") %>% 
  filter(unittype %in% c("C", "P", "SC"),
        section %in% c("CC", "OG")) %>% 
  select("year", "unittype", "weight", "section", "riv_section", "channel_class")
         
 
 sal_summary <- sal_weights_class %>% 
   group_by(channel_class) %>% 
   summarize(
     mean_weight = mean(weight, na.rm = TRUE),
     sd_weight = sd(weight, na.rm = TRUE),
     sample_size = n(),
     se_weight = sd(weight, na.rm = TRUE) / sqrt(n()),
     var_weight = var(weight, na.rm = TRUE))

# Histogram & QQ plot to test normalcy
 ggplot(data = sal_weights_class, aes(x = weight)) +
  geom_histogram() +
  facet_wrap(~channel_class)
 
ggplot(data = sal_weights_class, aes(sample = weight)) +
  geom_qq()+
  facet_wrap(~channel_class) 

#-----------------------
#Means do not have normal distribution, but ANOVA is relatively robust to violations of the normality assumption and the equal variance assumption.
#-----------------------

# Run levene test to test equal variance
leveneTest(weight ~ channel_class, data = sal_weights_class)
```



```{r}
## Graph to compare means by channel classification
ggplot() +
   geom_beeswarm(data = sal_weights_class,
                 aes(x = channel_class, y = weight),
                 size = 1,
                 alpha = 0.5,
                 color = "grey50") +
   geom_point(data = sal_summary,
              aes(x = channel_class, y = mean_weight),
              color = "red",
              size = 2)+
   geom_errorbar(data = sal_summary,
                 aes(x = channel_class,
                     ymin = mean_weight - sd_weight,
                     ymax = mean_weight + sd_weight),
                 width = 0.1,
                 color = "firebrick") +
  theme_bw() +
  labs(title = "Mean Salamander Size by Channel Class",
       subtitle = "Mack Creek, OR",
       x = "Channel Class",
       y = "Salamander Weight (grams)")
  


```
```{r}
#ANOVA Test

salamander_aov <- aov(weight ~ channel_class, data = sal_weights_class)
summary(salamander_aov)

# ANOVA Type III Test
salamander_lm <- lm(weight ~ channel_class, data = sal_weights_class)
salamander_aov_t3 <- Anova(salamander_lm)
salamander_aov_t3


# Tukey's HSD for post-hoc testing
TukeyHSD(salamander_aov)


aov_outputs <- unlist(summary(salamander_aov))
salamander_aov

# Cohen's d, salamander weight/channel classification
side_chan_class_weight <- sal_weights_class %>% 
  filter(unittype == "C") %>% 
  pull(weight)

pool_class_weight <- sal_weights_class %>% 
  filter(unittype == "SC") %>% 
  pull(weight)


creek_section_d <- cohen.d(side_chan_class_weight, pool_class_weight, na.rm = TRUE)
creek_section_d
```
Mean salamander weight (g) differed significantly between the side-channel and pool channel classifications (one-way ANOVA with post-hoc Tukey's HSD, F(`r aov_outputs[1]`, `r aov_outputs[2]`) = `r round(aov_outputs[7],2)`, *p* = `r round(aov_outputs[9],3)`). Although mean salamander weight differed significantly, the effect size is small (Cohen's *d* = `r round(creek_section_d$estimate, 2)`). 

### **Summary**

### **References**
**Gregory S. V. 2016.** Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/27/2019.
