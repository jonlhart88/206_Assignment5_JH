---
title: "Effects of forest condition and creek microhabitats on Pacific Giant Salamander abundance and size"
subtitle: "Study Site: Mack Creek, HJ Andrews Forest, Oregon, USA"
author: "Report by Jon Hart & Garrett Eyer"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE )
```
### **Introduction**

![](salamander_pic.PNG){width=400px}  
**Figure 1.** *Pacific Giant Salamander (Credit: [Sierra Nystrom](http://natural-history-journal.blogspot.com/2017/06/pacific-giant-salamander-at-prairie.html))*

![](map1.PNG){width=400px}  
**Figure 2.** *The Mack Creek study site is located in the HJ Andrews Experimental Forest, Oregon. (Credit: [Dana Warren](https://www.researchgate.net/figure/Map-of-study-sites-and-the-HJ-Andrews-Experimental-forest-HJA-Each-dot-represents-a_fig1_314206020))*

![](mack_creek.PNG){width=450px}  
**Figure 3.** *Mack Creek, HJ Andrews Experimental Forest, OR (Credit: [Oregon State University](https://www.flickr.com/photos/oregonstateuniversity/7468126552/))*

```{r}
# Attach necessary packages
library(tidyverse)
library(janitor)
library(here)
library(ggridges)
library(ggbeeswarm)
library(car)
library(kableExtra)
library(effsize)
library(directlabels)

```
### **Data and Methods**

### **Results**

```{r}
#-----------------
# Results. Part A.
#-----------------

# Wrangle salamander sample data for analyzing counts by different sections of Mack Creek
salamander_data <- read_csv("mack_creek_vertebrates.csv") %>% 
  clean_names() %>% 
  filter(species == "DITE") %>% 
  mutate(riv_section = case_when(
         section == "OG" ~ "Old Growth",
         section == "CC" ~ "Clear Cut")) %>% 
  mutate(channel_class = (case_when(
            unittype == "C" ~ "Cascade", 
            unittype == "SC" ~ "Side Channel",
            unittype == "P" ~ "Pool"))) 
  
# Create data frame for salamander counts by river section
sal_counts <- salamander_data %>% 
  group_by(year, riv_section) %>% 
  summarize(total_count = n())
 

# Create color vector for visualizing CC/OG sections of the river
colors_riv_section <- c("Clear Cut" = "tan3", "Old Growth" = "darkgreen")
   
# Graph salamander counts for 1993-2017 in both clear cut and old growth section of Mack Creek
ggplot(data = sal_counts, aes(x = year, y = total_count)) +
  geom_line(aes(color = riv_section),
            size = 1,
            show.legend = FALSE) +
  geom_point(size = 1.5) +
  scale_color_manual(values = colors_riv_section) +
  geom_dl(aes(label= riv_section, color=riv_section), 
          method = list("last.points", hjust = -.05)) +
  scale_x_continuous(expand = c(0,0),
                     limits = c(1992.5, 2022),
                     breaks = seq(1993, 2017, by = 2)) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0, 400),
                     breaks = seq(0, 500, by = 100)) +
  theme_minimal() +
  labs(title = "Pacific Giant Salamander Counts by Forest Condition",
       subtitle = "Mack Creek, OR (1993-2017)",
       x = "Year",
       y = "Salamander Count") +
  theme(axis.text.x = element_text(angle= 45, 
                                   hjust = 1),
        axis.ticks = element_line(size = 1)) 

            
```

**Figure 4.** *Number of Pacific Giant Salamanders recorded in Mack Creek from 1993-2017. Salamander counts have been seperated by whether they were recorded in the section of creek that runs through old growth forest or forest that was clear cut. Data: Andrews Forest LTER*


**Figure 5.** *Number of Pacific Giant Salamanders recorded in Mack Creek in 2017 by creek section (OG/CC) and channel classification.*
```{r}
#-----------------
# Results. Part B.
#-----------------


# Wrangle salamander data for comparing counts by channel classification and river section
sal_count_2017 <- salamander_data %>% 
  filter(year == "2017") %>% 
  filter(unittype %in% c("P", "C", "SC")) %>% 
  count(riv_section, channel_class)

# Put it into wide format (contingency table):
sal_count_table <- sal_count_2017 %>% 
  pivot_wider(names_from = riv_section, values_from = n)

# Make table with proportions
sal_count_props <- sal_count_table %>% 
  janitor::adorn_percentages(denominator = "row") %>% 
  adorn_pct_formatting(digits = 0) %>% 
  adorn_ns(position = "front") %>% 
  rename("Channel Class" = channel_class) 

# Put in a nicely formatted table
kable(sal_count_props) %>% 
  kable_styling(bootstrap_options = "bordered",
                full_width = F,
                position = "center")


```


```{r}
#-----------------
# Results. Part C.
#-----------------

# Create count table for Chi-Square test
chi_sal_counts <- sal_count_table %>% 
  select(-channel_class)

# Run Chi-Square test to determine significant associations between channel classification and creek section on salamander counts
sal_counts_chi <- chisq.test(chi_sal_counts)

```

There is not a significant association between forest condition (old growth/clear cut) on where in the channel salamanders are found (pool/side-channel/cascade) for salamanders sampled in 2017. ($\chi$^2^(`r sal_counts_chi$parameter`) = `r round(sal_counts_chi$statistic,2)`, *p* = `r round(sal_counts_chi$p.value, 3)`).

```{r}

#------------------
# Results. Part D.
#------------------

# Create data frames for salamanders sampled in 2017 for clear cut and old growth sections of Mack Creek

sal_weights_cc <- salamander_data %>% 
  filter(year == "2017", section == "CC") 

sal_weights_og <- salamander_data %>%   
  filter(year == "2017", section == "OG") 

# Calculate mean weights (old growth vs. clear cut)
mean_weights_cc <- mean(sal_weights_cc$weight, na.rm = TRUE)
mean_weights_og <- mean(sal_weights_og$weight, na.rm = TRUE)

# Calculate mean weight standard deviation (old growth vs. clear cut)
sd_weights_cc <- sd(sal_weights_cc$weight, na.rm = TRUE)
sd_weights_og <- sd(sal_weights_og$weight, na.rm = TRUE)

# Calculate sample size (old growth vs. clear cut)
n_2017_cc <- sum(!is.na(sal_weights_cc$weight))
n_2017_og <- sum(!is.na(sal_weights_og$weight))

# Perform two sided t-test on mean weights between clear cut and old growth sections of Mack Creek
weight_ttest_og <- sal_weights_og %>% 
  pull(weight)

weight_ttest_cc <- sal_weights_cc %>% 
  pull(weight)

sal_weight_ttest <- t.test(weight_ttest_og, weight_ttest_cc)


# Calculate Cohen's d 
sal_weight_d <- cohen.d(weight_ttest_cc, weight_ttest_og, na.rm = TRUE)

```

```{r}
# Create summary table for salamander weights by creek section (CC vs OG)

sal_summary_fc <- salamander_data %>% 
  filter(year == "2017") %>% 
   group_by(riv_section) %>% 
   summarize(
     mean_weight = mean(weight, na.rm = TRUE),
     sd_weight = sd(weight, na.rm = TRUE),
     sample_size = n(),
     se_weight = sd(weight, na.rm = TRUE) / sqrt(n()),
     var_weight = var(weight, na.rm = TRUE)) 
```

```{r}
# Creat beeswarm graph to compare salamander weights by creek section (CC vs OG)

sal_2017 <- salamander_data %>% 
  filter(year == "2017") 

ggplot() +
   geom_beeswarm(data = sal_2017,
                 aes(x = riv_section, y = weight, 
                     color = riv_section),
                 size = 1,
                 show.legend = FALSE,
                 alpha = 0.5) +
  scale_color_manual(values = colors_riv_section) +
   geom_point(data = sal_summary_fc,
              aes(x = riv_section, y = mean_weight),
              color = "black",
              size = 2.5)+
   geom_errorbar(data = sal_summary_fc,
                 aes(x = riv_section,
                     ymin = mean_weight - sd_weight,
                     ymax = mean_weight + sd_weight),
                 width = 0.1,
                 size = .75,
                 color = "black") +
  theme_bw() +
  labs(title = "Mean Salamander Weight by Creek Section (2017)",
       subtitle = "Mack Creek, OR",
       x = "Creek Section (Forest Condition)",
       y = "Salamander Weight (grams)") 

```

**Figure 6.** *Recorded weights of Pacific Giant Salamanders sampled in Mack Creek in 2017 by section of the creek found (CC/OG). The black dot represents the sample mean with error bars representing the range of uncertainty. Data: Andrews Forest LTER* 

**Figure 7.** *Pacific Giant Salamander sample statistics in 2017 by section of Mack Creek (CC/OG)*
```{r}
# Create nicely formatted table for summary statistics on salamanders sampled in 2017 for old growth vs clear cut sections of Mack Creek

sal_summary_fc_table <- salamander_data %>% 
  filter(year == "2017") %>% 
   group_by(riv_section) %>% 
   summarize(
     mean_weight = mean(weight, na.rm = TRUE),
     sd_weight = sd(weight, na.rm = TRUE),
     sample_size = n(),
     se_weight = sd(weight, na.rm = TRUE) / sqrt(n()),
     var_weight = var(weight, na.rm = TRUE)) %>% 
  rename("Creek Section" = riv_section,
         "Mean Weight (g)" = mean_weight,
         "Standard Deviation (g)" = sd_weight,
         "Sample Size" = sample_size,
         "Standard error" = se_weight,
         "Variance" = var_weight)

kable(sal_summary_fc_table) %>% 
  kable_styling(bootstrap_options = "bordered",
                full_width = F,
                position = "center")
  
```


There is not enough evidence to conclude that mean Pacific Giant Salamander size in the clear cut section of Mack Creek in 2017 (`r round(mean_weights_cc, 2)` $\pm$ `r round(sd_weights_cc, 2)`, n = `r n_2017_cc`) differed significantly from mean Pacific Giant Salamander size in the old growth section of Mack Creek in 2017 (`r round(mean_weights_og, 2)` $\pm$ `r round(sd_weights_og, 2)`, n = `r n_2017_og`) by a two-sided, two sample t-test (t(`r round(sal_weight_ttest$parameter, 2)`) = `r round(sal_weight_ttest$statistic, 2)`, *p* = `r round(sal_weight_ttest$p.value, 3)`). In addition, the effect size between mean sizes is negligible (Cohen's *d* = `r round(sal_weight_d$estimate, 2)`). 


```{r}
#---------------------
# Results. Part E.
#---------------------

# Create data frame to compare salamander weights between the three channel classifications in 2017
sal_weights_class <- salamander_data %>% 
  filter(year == "2017") %>% 
  filter(unittype %in% c("C", "P", "SC"),
        section %in% c("CC", "OG")) %>% 
  select("year", "unittype", "weight", "section", "riv_section", "channel_class")
         
 # Create sample summary table
 sal_summary <- sal_weights_class %>% 
   group_by(channel_class) %>% 
   summarize(
     mean_weight = mean(weight, na.rm = TRUE),
     sd_weight = sd(weight, na.rm = TRUE),
     sample_size = n(),
     se_weight = sd(weight, na.rm = TRUE) / sqrt(n()),
     var_weight = var(weight, na.rm = TRUE)) 

# Create Histogram to test for normality
 ggplot(data = sal_weights_class, aes(x = weight)) +
  geom_histogram(color = "black",
                 fill = "deepskyblue3") +
  facet_wrap(~channel_class) +
  scale_x_continuous(expand = c(0,0),
                     breaks = seq(0, 80, by = 10)) +
  scale_y_continuous(expand = c(0,0),
                     limits = c(0, 130)) +
   theme_bw() +
   labs(title = "Salamanader Sample Normality Testing (1)",
       subtitle = "Mack Creek, OR (2017)",
       x = "Salamander Weights (grams)",
       y = "Count")
```

**Figure 8.** *Recorded weights of Pacific Giant Salamanders sampled in Mack Creek in 2017 by channel classification. Data: Andrews Forest LTER*



```{r}
# Create qq plot to test for normality
ggplot(data = sal_weights_class, aes(sample = weight)) +
  geom_qq()+
  facet_wrap(~channel_class) +
  theme_bw() +
  labs(title = "Salamanader Sample Normality Testing (2)",
       subtitle = "Mack Creek, OR (2017)",
       x = "Theoretical Quantiles",
       y = "Sample Quantiles")

#-----------------------
# Means do not have normal distribution, but ANOVA is relatively robust to 
# violations # of the normality assumption and the equal variance assumption.
#-----------------------

```

**Figure 9.** *Using a quantile-quantile plot we can assess whther the 2017 salamander sample comes from a population that has weights which are normally distributed. We do not see the linear trend that would suggest normality for all three channel classifications. Data: Andrews Forest LTER*


```{r}
# Run levene test to test equal variance
sal_levene <- leveneTest(weight ~ channel_class, data = sal_weights_class)
```




```{r}

# Create beeswarm graph to compare salamander means by channel classification
ggplot() +
   geom_beeswarm(data = sal_weights_class,
                 aes(x = channel_class, y = weight, 
                     color = channel_class),
                 size = 1,
                 show.legend = FALSE,
                 alpha = 0.5) +
   geom_point(data = sal_summary,
              aes(x = channel_class, y = mean_weight),
              color = "black",
              size = 2.5)+
   geom_errorbar(data = sal_summary,
                 aes(x = channel_class,
                     ymin = mean_weight - sd_weight,
                     ymax = mean_weight + sd_weight),
                 width = 0.1,
                 size = .75,
                 color = "black") +
  theme_bw() +
  labs(title = "Salamander Weight by Channel Classification (2017)",
       subtitle = "Mack Creek, OR",
       x = "Channel Class",
       y = "Salamander Weight (grams)") 
  
```

**Figure 10.** *Recorded weights of Pacific Giant Salamanders sampled in Mack Creek in 2017 by channel classification. The black dot represents the sample mean with error bars representing the range of uncertainty.*


**Figure 11.** *Pacific Giant Salamander sample statistics in 2017 by different channel classifications in Mack Creek*
```{r}
# Put summary statistics into a nicely formatted/renamed table
 
sal_summary_table_tidy <- sal_weights_class %>% 
   group_by(channel_class) %>% 
   summarize(
     mean_weight = mean(weight, na.rm = TRUE),
     sd_weight = sd(weight, na.rm = TRUE),
     sample_size = n(),
     se_weight = sd(weight, na.rm = TRUE) / sqrt(n()),
     var_weight = var(weight, na.rm = TRUE)) %>% 
rename("Channel Class" = channel_class,
         "Mean Weight (g)" = mean_weight,
         "Standard Deviation (g)" = sd_weight,
         "Sample Size" = sample_size,
         "Standard error" = se_weight,
         "Variance" = var_weight)
 

kable(sal_summary_table_tidy) %>% 
   kable_styling(bootstrap_options = "bordered",
                full_width = F,
                position = "center")
```


```{r}
# Perform one-way ANOVA test
salamander_aov <- aov(weight ~ channel_class, data = sal_weights_class)


# Perform ANOVA Type III test to compare results from type 1 ANOVA due to data skewness
salamander_lm <- lm(weight ~ channel_class, data = sal_weights_class)
salamander_aov_t3 <- Anova(salamander_lm)

#-----------------
# No real difference between the two ANOVA tests
#-----------------

# Perform Tukey's HSD for post-hoc testing
sal_post_hoc <- TukeyHSD(salamander_aov)


#-----------------
# Only means in side-channel vs. Pool creek classes are significantly different
#-----------------

# Get AOV outputs for in-line referencing of results
aov_outputs <- unlist(summary(salamander_aov))

# Perform Cohen's d for salamander weight/channel classification
side_chan_class_weight <- sal_weights_class %>% 
  filter(unittype == "C") %>% 
  pull(weight)

pool_class_weight <- sal_weights_class %>% 
  filter(unittype == "SC") %>% 
  pull(weight)

creek_section_d <- cohen.d(side_chan_class_weight, pool_class_weight, na.rm = TRUE)

```
Mean salamander weight (g) differed significantly between the three creek channel classifications (pool, cascade, side-channel) by a one-way ANOVA test (F(`r aov_outputs[1]`, `r aov_outputs[2]`) = `r round(aov_outputs[7],2)`, *p* = `r round(aov_outputs[9],3)`). Further pairwise testing using pot-hoc Tukey's HSD revealed that mean salamander weight was only significantly different between side-channel and pool classifications (*p* = `r round(sal_post_hoc$channel_class[12],3)`). Though a significant difference in mean weight was found between salamanders sampled in the pools vs. side-channel sections of Mack Creek in 2017, the effect size was small (Cohen's *d* = `r round(creek_section_d$estimate, 2)`). 


### **Summary**

-
-
-

### **References**
**Gregory S. V. 2016.** Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/27/2019.
